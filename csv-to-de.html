%%[
SET @overwriteDE = "YourTargetDEName"
]%%

<!DOCTYPE html>
<html>
<head>
  <title>Drag & Drop CSV to Overwrite DE</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #dropZone {
      width: 100%;
      max-width: 400px;
      height: 200px;
      border: 2px dashed #aaa;
      border-radius: 10px;
      text-align: center;
      line-height: 200px;
      color: #666;
      margin-bottom: 20px;
      transition: border-color 0.3s;
    }
    #dropZone.dragover {
      border-color: #0070c0;
      color: #0070c0;
    }
    #previewContainer {
      margin-top: 20px;
    }
    #previewImage {
      max-width: 100%;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    #downloadLink {
      display: inline-block;
      padding: 8px 12px;
      background-color: #0070c0;
      color: white;
      text-decoration: none;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h2>CSV to Data Extension</h2>
  <div id="dropzone">Drop CSV file here</div>
  <form id="uploadForm" method="post" enctype="multipart/form-data">
    <input type="file" name="csvfile" id="csvfile" accept=".csv" style="display:none" />
    <input type="submit" value="Upload" style="display:none" />
  </form>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('csvfile');
    const form = document.getElementById('uploadForm');

    dropzone.addEventListener('dragover', function(e) {
      e.preventDefault();
      dropzone.classList.add('dragover');
    });

    dropzone.addEventListener('dragleave', function(e) {
      dropzone.classList.remove('dragover');
    });

    dropzone.addEventListener('drop', function(e) {
      e.preventDefault();
      dropzone.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0 && files[0].type === "text/csv") {
        fileInput.files = files;
        form.submit();
      } else {
        alert("Please drop a valid CSV file.");
      }
    });
  </script>

  <script runat="server">
    Platform.Load("Core", "1.1.1");

    var overwriteDE = Variable.GetValue("@overwriteDE");
    var uploadedFile = Request.GetUploadedFile("csvfile");

    if (uploadedFile && uploadedFile.Content) {
      var csvContent = uploadedFile.Content;
      var lines = csvContent.split(/\r?\n/);
      var headers = lines[0].split(",");

      // Clear existing rows
      Platform.Function.DeleteData(overwriteDE, ["1"], ["1"]);

      // Insert new rows
      for (var i = 1; i < lines.length; i++) {
        var row = lines[i].split(",");
        if (row.length === headers.length) {
          var data = {};
          for (var j = 0; j < headers.length; j++) {
            data[headers[j].trim()] = row[j].trim();
          }
          Platform.Function.InsertData(overwriteDE, data);
        }
      }

      Write("<p style='color:green;'>Data Extension overwritten successfully.</p>");
    } else {
      Write("<p style='color:red;'>No file uploaded or file is empty.</p>");
    }
  </script>
</body>
</html>