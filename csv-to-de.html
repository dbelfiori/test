<h2>üìã Paste CSV Content</h2>
<form method="post">
  <textarea name="csvText" rows="10" cols="100" placeholder="Paste CSV here..." required></textarea>
  <br><br>
  <input type="submit" value="Preview and Upsert" />
</form>

%%[
SET @csvContent = RequestParameter("csvText")
SET @deName = "db-SS-Tracker"

IF NOT EMPTY(@csvContent) THEN
  SET @lines = BuildRowsetFromString(@csvContent, "\n")
  SET @rowCount = RowCount(@lines)

  IF @rowCount > 1 THEN
    SET @headerRow = Row(@lines, 1)
    SET @headers = BuildRowsetFromString(@headerRow, ",")
    SET @fieldCount = RowCount(@headers)
    SET @inserted = 0

    OUTPUT("<table border='1'><thead><tr>")
    FOR @h = 1 TO @fieldCount DO
      SET @header = Field(Row(@headers, @h), 1)
      OUTPUT(CONCAT("<th>", @header, "</th>"))
    NEXT @h
    OUTPUT("</tr></thead><tbody>")

    FOR @i = 2 TO @rowCount DO
      SET @line = Row(@lines, @i)
      SET @fields = BuildRowsetFromString(@line, ",")

      IF RowCount(@fields) == @fieldCount THEN
        OUTPUT("<tr>")
        FOR @j = 1 TO @fieldCount DO
          SET @value = Field(Row(@fields, @j), 1)
          OUTPUT(CONCAT("<td>", @value, "</td>"))
        NEXT @j
        OUTPUT("</tr>")

        /* Static mapping ‚Äî adjust indexes to match your DE */
        SET @FISCAL_WEEK_ID = Field(Row(@fields, 1), 1)
        SET @Promo_StartDeployDate = Field(Row(@fields, 2), 1)
        SET @Deploy_Time = Field(Row(@fields, 3), 1)
        SET @Media_Type = Field(Row(@fields, 4), 1)
        SET @Campaign_Type = Field(Row(@fields, 5), 1)
        SET @Campaign_Name = Field(Row(@fields, 6), 1)
        SET @Campaign_Manager = Field(Row(@fields, 7), 1)
        SET @Audience_Prepared_by = Field(Row(@fields, 8), 1)
        SET @Developer = Field(Row(@fields, 9), 1)
        SET @Checklist = Field(Row(@fields, 10), 1)
        SET @Campaign_Producer = Field(Row(@fields, 11), 1)
        SET @Creative_Job_ = Field(Row(@fields, 12), 1)
        SET @Creative_DUE____modify_dayslogic = Field(Row(@fields, 13), 1)
        SET @Campaign_Scheduled_Actual_Date = Field(Row(@fields, 14), 1)

        IF NOT EMPTY(@Campaign_Name) THEN
          UPSERTDE(@deName, 1, "Campaign_Name", @Campaign_Name,
            "FISCAL_WEEK_ID", @FISCAL_WEEK_ID,
            "Promo_StartDeployDate", @Promo_StartDeployDate,
            "Deploy_Time", @Deploy_Time,
            "Media_Type", @Media_Type,
            "Campaign_Type", @Campaign_Type,
            "Campaign_Manager", @Campaign_Manager,
            "Audience_Prepared_by", @Audience_Prepared_by,
            "Developer", @Developer,
            "Checklist", @Checklist,
            "Campaign_Producer", @Campaign_Producer,
            "Creative_Job_", @Creative_Job_,
            "Creative_DUE____modify_dayslogic", @Creative_DUE____modify_dayslogic,
            "Campaign_Scheduled_Actual_Date", @Campaign_Scheduled_Actual_Date
          )
          SET @inserted = Add(@inserted, 1)
        ENDIF
      ENDIF
    NEXT @i

    OUTPUT("</tbody></table>")
    OUTPUT(CONCAT("<p style='color:green;'>‚úÖ Upserted ", @inserted, " rows into ", @deName, ".</p>"))
  ELSE
    OUTPUT("<p style='color:red;'>‚ùå CSV must contain a header and at least one data row.</p>")
  ENDIF
ELSE
  OUTPUT("<p>üïí Waiting for CSV input...</p>")
ENDIF
]%%